openapi: 3.0.3
info:
  title: Bitcoin Data Service
  description: Allows bitcoin SPV (Simple Payment Verification) Clients to have a stateless access to the bitcoin network. A bitcoin data service will be designed such as to optimize the anonymity of SPV clients. ???
  version: 0.1.0
tags:
  - name: bitcoin
    description: Access to the bitcoin network for SPV-Clients
servers:
  - url: https://localhost:9092/
    description: EWU
paths:
  /btc/transactions:
    post:
      tags:
        - bitcoin
      operationId: submitTransaction
      description: |
        Relay transactions produced by the SPV client to the bitcoin network.
      summary: Submit a transaction to the bitcoin network
      requestBody:
        required: true
        description: Transaction to be forwarded to the bitcoin network.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransactionDto'
      responses:
        "200":
          description: Transaction successfully submitted.
  /btc/transactions/{txId}:
    get:
      tags:
        - bitcoin
      operationId: checkTransaction
      description: |
        A submitted transaction is considered valid, when the transaction was forwarded to the MemPool nodes. Even though the bitcoin
        data service can validate transaction, having those transactions reported by other nodes as seen in the MemPool is part of
        validating the correctness of the transaction (Format, Signature)
      summary: Check if a transaction submitted to the network is valid.
      parameters:
        - in: path
          name: txId
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Number of reporting nodes. A value greater than 0 means that the transaction is in the mempool.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckTransactionResponse'
        "404":
          description: Transaction not found.
  /btc/transactions/{txId}/block:
    get:
      tags:
        - bitcoin
      operationId: getBlockByTransactionId
      description: |
        Find the block hosting a given transaction by id.
      summary: Find the block hosting a given transaction by id
      parameters:
        - in: path
          name: txId
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Block information, where the transaction is located.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FindBlockResponse'
        "404":
          description: Transaction not found.
  /btc/blocks/{blockId}:
    get:
      tags:
        - bitcoin
      operationId: getBlock
      description: |
        Get a block by id.
      summary: Find the block by id
      parameters:
        - in: path
          name: blockId
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Block information.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BlockDto'
        "404":
          description: Block not found.
  /btc/blocks/height:
    get:
      tags:
        - bitcoin
      operationId: getBlocksByHeight
      description: |
        List all blocks within startHeight and endHeight.
      summary: List Blocks
      parameters:
        - in: query
          name: startHeight
          required: true
          description: Start height
          schema:
            type: integer
        - in: query
          name: endHeight
          required: true
          description: End height
          schema:
            type: integer
      responses:
        "200":
          description: List all blocks within startHeight and endHeight.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BlockHeadersResponse'
  /btc/blocks/time:
    get:
      tags:
        - bitcoin
      operationId: getBlocksByTime
      description: |
        List the next quantity blocks from startTime.
      summary: List Blocks
      parameters:
        - in: query
          name: startTime
          required: true
          schema:
            type: integer
        - in: query
          name: quantity
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: List the next quantity blocks from startTime.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BlockHeadersResponse'

components:
  schemas:
    CheckTransactionResponse:
      type: object
      required:
        - reportingBlocks
      properties:
        reportingBlocks:
          type: integer
          description: Number of reporting blocks.
    FindBlockResponse:
      type: object
      required:
        - hash
        - depth
      properties:
        blockId:
          type: string
          description: Identifier of the block containing this transaction in the best chain.
        depth:
          type: integer
          description: How deep is the block in the best chain.
    BlockDto:
      type: object
      required:
        - blockBytes
      properties:
        blockBytes:
          type: string
          format: byte
    BlockHeadersResponse:
      type: object
      required:
        - blocks
      properties:
        blocks:
          type: array
          items:
            $ref: '#/components/schemas/BlockHeaderDto'
    BlockHeaderDto:
      type: object
      required:
        - blockId
        - prevBlockHash
        - height
        - time
        - txIds
      properties:
        blockId:
          type: string
        prevBlockHash:
          type: string
        height:
          type: integer
        time:
          type: integer
        txIds:
          type: array
          items:
            type: string
            description: Transaction Id
    TransactionDto:
      type: object
      required:
        - transactionBytes
      properties:
        transactionBytes:
          type: string
          format: byte
